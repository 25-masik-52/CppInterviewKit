#### **1. Определение**  
**Паттерн Состояние (State)** — это поведенческий паттерн, позволяющий объекту изменять своё поведение при изменении внутреннего состояния. Создаётся впечатление, что объект изменил свой класс.  

#### **2. Код-пример**  
**Пример: Документ с изменяемым состоянием**  
```cpp
#include <iostream>
#include <memory>

// Интерфейс состояния
class DocumentState {
public:
    virtual ~DocumentState() = default;
    virtual void publish() = 0;
    virtual void render() const = 0;
};

// Конкретные состояния
class Draft : public DocumentState {
public:
    void publish() override {
        std::cout << "Перевод документа на модерацию.\n";
    }
    void render() const override {
        std::cout << "[Черновик] Редактирование доступно.\n";
    }
};

class Moderation : public DocumentState {
public:
    void publish() override {
        std::cout << "Документ опубликован!\n";
    }
    void render() const override {
        std::cout << "[На модерации] Ожидание проверки.\n";
    }
};

class Published : public DocumentState {
public:
    void publish() override {
        std::cout << "Документ уже опубликован.\n";
    }
    void render() const override {
        std::cout << "[Опубликован] Только для чтения.\n";
    }
};

// Контекст (документ)
class Document {
    std::unique_ptr<DocumentState> state_;
public:
    Document() : state_(std::make_unique<Draft>()) {}

    void setState(std::unique_ptr<DocumentState> newState) {
        state_ = std::move(newState);
    }

    void publish() {
        state_->publish();
    }

    void render() const {
        state_->render();
    }
};

int main() {
    Document doc;
    doc.render(); // [Черновик] Редактирование доступно.

    doc.publish(); // Перевод документа на модерацию.
    doc.setState(std::make_unique<Moderation>());
    doc.render(); // [На модерации] Ожидание проверки.

    doc.publish(); // Документ опубликован!
    doc.setState(std::make_unique<Published>());
    doc.render(); // [Опубликован] Только для чтения.
}
```
**Вывод:**  
```
[Черновик] Редактирование доступно.  
Перевод документа на модерацию.  
[На модерации] Ожидание проверки.  
Документ опубликован!  
[Опубликован] Только для чтения.  
```

#### **3. Компоненты и связи**  
- **State (DocumentState)**  
  Интерфейс для всех состояний.  
- **Concrete State (Draft, Moderation, Published)**  
  Реализуют поведение для конкретного состояния.  
- **Context (Document)**  
  Хранит текущее состояние и делегирует ему работу.  

#### **4. Плюсы паттерна**  
- **Устранение условных операторов**: Логика распределена по классам состояний.  
- **Гибкость**: Новые состояния добавляются без изменения контекста.  
- **Чистый код**: Каждое состояние инкапсулирует свою логику.  

#### **5. Когда использовать?**  
- Когда поведение объекта зависит от его состояния.  
- При часто изменяющихся состояниях с сложной логикой.  
- Для замены больших `switch` или `if-else` конструкций.  

#### **6. Подводные камни и решения**  
**Минусы:**  
- **Много классов**: Для простых случаев может быть избыточным.  
- **Зависимость контекста**: Контекст знает о всех состояниях.  

**Способы решения:**  
- Использовать **фабрику состояний** для управления созданием.  
- Применять **паттерн Visitor** для сложной логики переходов.  

#### **7. Альтернативы и отличия от других паттернов**  

| **Паттерн**       | **Отличие от State**                     |
|-------------------|------------------------------------------|
| **Стратегия**     | Клиент выбирает стратегию, состояния меняются автоматически. |
| **Команда**       | Инкапсулирует действие, а не состояние.  |
| **Хранитель**     | Сохраняет состояние, а не управляет поведением. |

#### **8. Примеры в реальных проектах**  
- **Документооборот**: Изменение статусов документов.  
- **Игры**: Поведение персонажа (бег/атака/защита).  
- **UI**: Состояния кнопок (активна/неактивна/нажата).  

**Идеальный ответ:**  
*"Паттерн State позволяет объекту изменять поведение при смене внутреннего состояния. Состоит из State (интерфейс), ConcreteState (реализации) и Context (исполнитель). Пример — документ с состояниями "Черновик/Модерация/Опубликован". Плюсы: устранение условных операторов и гибкость. Минус: много классов для простых случаев. Отличается от Стратегии (ручной выбор алгоритма) и Команды (инкапсуляция действий)."*