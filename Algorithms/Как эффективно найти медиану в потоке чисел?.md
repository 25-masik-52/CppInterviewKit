#### **1. Определение медианы**  
Медиана — это значение, которое делит упорядоченный набор чисел на две равные части:  
- Для нечётного количества чисел: средний элемент.  
- Для чётного: среднее арифметическое двух центральных элементов.  

**Примеры**:  
- `[1, 3, 5]` → медиана = `3`.  
- `[1, 3, 5, 7]` → медиана = `(3 + 5) / 2 = 4`.

#### **2. Проблема потоковой обработки**  
При поступлении чисел по одному (например, из датчика или логов) нужно поддерживать актуальную медиану после каждого добавления.  
- **Наивное решение**: Сортировка массива после каждого добавления → `O(n log n)` на операцию.  
- **Эффективное решение**: Использование двух куч → `O(log n)` на добавление и `O(1)` на поиск медианы.  

#### **3. Алгоритм с двумя кучами**  

##### **Структуры данных**  
1. **Макс-куча (`maxHeap`)**:
   - Хранит **меньшую половину** чисел.  
   - Корень — максимум этой половины.  
2. **Мин-куча (`minHeap`)**:
   - Хранит **большую половину** чисел.  
   - Корень — минимум этой половины.  

##### **Условия баланса**  
- Размеры куч отличаются не более чем на 1.  
- Все элементы в `maxHeap` ≤ элементов в `minHeap`.  

##### **Операции**  
1. **Добавление числа (`addNum`)**:  
   - Если число ≤ корня `maxHeap` → добавляем в `maxHeap`.  
   - Иначе → добавляем в `minHeap`.  
   - Балансируем кучи:  
     - Если `maxHeap` больше `minHeap` на 2 → перемещаем корень `maxHeap` в `minHeap`.  
     - Если `minHeap` больше `maxHeap` → перемещаем корень `minHeap` в `maxHeap`.  

2. **Поиск медианы (`findMedian`)**:  
   - Если кучи равны по размеру → медиана = среднее их корней.  
   - Иначе → медиана = корень большей кучи.  

#### **4. Реализация на C++**  
```cpp
#include <queue>
#include <vector>

class MedianFinder {
private:
    std::priority_queue<int> maxHeap; // Макс-куча для меньшей половины
    std::priority_queue<int, std::vector<int>, std::greater<>> minHeap; // Мин-куча для большей половины

public:
    void addNum(int num) {
        if (maxHeap.empty() || num <= maxHeap.top()) {
            maxHeap.push(num);
        } else {
            minHeap.push(num);
        }

        // Балансировка
        if (maxHeap.size() > minHeap.size() + 1) {
            minHeap.push(maxHeap.top());
            maxHeap.pop();
        } else if (minHeap.size() > maxHeap.size()) {
            maxHeap.push(minHeap.top());
            minHeap.pop();
        }
    }

    double findMedian() {
        if (maxHeap.size() == minHeap.size()) {
            return (maxHeap.top() + minHeap.top()) / 2.0;
        } else {
            return maxHeap.top();
        }
    }
};
```
**Пример использования**:  
```cpp
MedianFinder mf;
mf.addNum(5);    // Медиана: 5
mf.addNum(15);   // Медиана: (5 + 15) / 2 = 10
mf.addNum(1);    // Медиана: 5
mf.addNum(3);    // Медиана: (3 + 5) / 2 = 4
```

#### **5. Производительность**  

| **Операция**   | **Сложность** |
| -------------- | ------------- |
| `addNum(num)`  | `O(log n)`    |
| `findMedian()` | `O(1)`        |

**Почему?**  
- Вставка в кучу: `O(log n)`.  
- Доступ к корню: `O(1)`.  

#### **6. Сравнение с другими методами**  

| **Метод**          | **Сложность добавления** | **Сложность поиска медианы** |
| ------------------ | ------------------------ | ---------------------------- |
| **Две кучи**       | `O(log n)`               | `O(1)`                       |
| **Сортировка**     | `O(n log n)`             | `O(1)`                       |
| **Связный список** | `O(n)`                   | `O(n)`                       |

**Преимущества двух куч**:  
- Оптимально для потоковых данных.  
- Не требует хранения отсортированного массива.  

#### **7. Применение**  
- **Онлайн-анализ данных**: Финансовые транзакции, сенсорные данные.  
- **Системы мониторинга**: Вычисление медианных задержек в реальном времени.  

**Идеальный ответ:**
_Для эффективного поиска медианы в потоке чисел используйте **две кучи**:_
_- **Макс-куча** хранит меньшую половину, **мин-куча** — большую._
_- **Балансировка** после каждого добавления гарантирует разницу размеров ≤ 1._
_- **Медиана**:_
  _- Если кучи равны → среднее корней._
  _- Иначе → корень большей кучи._
_**Сложность**:_
_- Добавление: `O(log n)`._
_- Поиск медианы: `O(1)`._
_**Пример**:_
```cpp
MedianFinder mf;
mf.addNum(10); 
mf.addNum(20); 
cout << mf.findMedian();  // 15.0
```