#### 1. **Определение**  
**CRTP (Curiously Recurring Template Pattern)** — это идиома C++, при которой класс наследуется от шаблона базового класса, параметризованного самим производным классом. Формально:  
```cpp  
template <typename Derived>  
class Base { /* ... */ };  

class Derived : public Base<Derived> { /* ... */ };  
```  

#### 2. **Пример кода**  
```cpp  
template <typename T>  
class Counter {  
public:  
    static int count;  
    Counter() { ++count; }  
    ~Counter() { --count; }  
};  

template <typename T>  
int Counter<T>::count = 0;  

class Widget : public Counter<Widget> {};  

int main() {  
    Widget w1, w2;  
    std::cout << Widget::count; // Выведет: 2  
}  
```  

#### 3. **Как работает CRTP**  
- **Статический полиморфизм**: Базовый класс вызывает методы производного через `static_cast<Derived*>(this)`.  
- **Инъекция поведения**: Базовый класс расширяет функциональность производного на этапе компиляции.  

#### 4. **Плюсы CRTP**  
- **Производительность**: Нет накладных расходов на виртуальные функции (`vtable`).  
- **Гибкость**: Позволяет реализовать "миксины" (добавление функциональности).  
- **Компиляторная оптимизация**: Методы могут быть встроены (`inline`).  

#### 5. **Когда использовать?**  
- Когда нужен **статический полиморфизм** (избегание `virtual`).  
- Для **подсчёта объектов**, **добавления интерфейсов** (например, `Printable`).  
- В **библиотеках** (например, `std::enable_shared_from_this`).  

#### 6. **Ограничения**  
- **Нет динамического полиморфизма**: Нельзя использовать с разными типами через базовый указатель.  
- **Сложность отладки**: Ошибки компиляции могут быть запутанными.  
- **Жёсткая привязка**: Производный класс жёстко связан с базовым.  

#### 7. **CRTP vs. Виртуальные функции**  
| Критерий        | CRTP                   | Виртуальные функции |
| --------------- | ---------------------- | ------------------- |
| **Скорость**    | Быстрее (нет `vtable`) | Медленнее           |
| **Полиморфизм** | Статический            | Динамический        |
| **Память**      | Нет `vptr`             | Есть `vptr`         |

**Идеальный ответ:**
*"CRTP — это шаблонная идиома C++, где класс наследуется от базового шаблона, параметризованного самим собой. Она позволяет реализовать статический полиморфизм без накладных расходов на виртуальные функции. Например, для подсчёта объектов или добавления интерфейсов (как `Printable`). Плюсы: производительность, гибкость. Минусы: нет динамического полиморфизма, сложность отладки. Используйте CRTP, когда важна скорость и компиляторная оптимизация, но избегайте для сценариев с динамическим выбором типов."*